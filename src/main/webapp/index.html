<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="UTF-8">
  <title>Dora</title>
  <script src="/dora/js/jquery-3.3.1.min.js"></script>
</head>
<body>

<div style="text-align:center">
  <label for="input_width">Width:</label>
  <input id="input_width" type="text" value="16"/>
  <label for="input_height">Height:</label>
  <input id="input_height" type="text" value="9"/>
  <label for="input_brush">BrushSize:</label>
  <input id="input_brush" type="text" value="4"/>

  <label for="input_brush">Type:</label>
  <select id="select_m_type" name="m_type">
    <optgroup label="Maze">
      <option value="rb">RecursiveBacktracking</option>
      <option value="rd">RecursiveDivision</option>
      <option value="prim">Prim's</option>
      <option value="eller">Eller's</option>
    </optgroup>
    <optgroup label="Dungeon">
      <option value="ca">Cellular Atomaton Dungeon</option>
    </optgroup>
  </select>
  <input id="btn_draw" type="button" value="draw"/>
</div>

<hr/>
<div>
  <canvas id="draw_canvas"></canvas>
</div>
<script>
  var ACCESSIBLE = '#e3e3e3', BLOCKED = '#3e3e3e', BORDER = ACCESSIBLE;

  var j = jQuery.noConflict();
  j('#btn_draw').bind("click", function () {
    var width = j('#input_width').val(), height = j('#input_height').val(), brush = j('#input_brush').val();
    var mType = j('#select_m_type').val();
    var url = '/dora/maze/';

    url += mType + '?';
    url += 'w=' + width + '&';
    url += 'h=' + height + '&';
    url += 'b=' + brush + '&';
    j.ajax({
      url: url,
      success: function (resp) {
        var data = resp['data'];
        var rows = resp['rows'];
        var cols = resp['columns'];
        var bd = 5, b = brush;

        var canvas = j('#draw_canvas')[0];
        var ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, 1000, 800);
        // Draw border
        ctx.fillStyle = BORDER;
        ctx.fillRect(0, 0, 2 * bd + b * cols, bd);
        ctx.fillRect(0, bd + b * rows, 2 * bd + b * cols, bd);
        ctx.fillRect(0, bd, bd, b * rows);
        ctx.fillRect(bd + b * cols, bd, bd, b * rows);

        for (var r = 0; r < rows; r++) {
          for (var c = 0; c < cols; c++) {
            var index = r * cols + c;
            var cell = data.charAt(index);
            if (cell == '0') {
              ctx.fillStyle = ACCESSIBLE;
            } else {
              ctx.fillStyle = BLOCKED;
            }
            ctx.fillRect(bd + c * b, bd + r * b, b, b);
          }
        }
      }
    });
  });
</script>
</body>
</html>